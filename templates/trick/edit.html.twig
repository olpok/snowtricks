{% extends 'base.html.twig' %}

{% block title %}Edit Trick{% endblock %}

{% block body %}
<div class="container">
    <h1>Edit Trick</h1>
    {% for message in app.flashes('success') %}
    <div class="alert alert-success">
        {{message}}
    </div>
    {% endfor %}
    <div>
        <h5>Images</h5>
        {% for image in trick.images %}
        <div class="col-md-5" style="width:100 px; flex: none; margin: 5px">
            <img src="{{vich_uploader_asset(image,'imageFile') }} " width="100" alt="">
            <form method="post" action="{{ path('image_delete', {'id': image.id}) }}"
                onsubmit="return confirm('Êtes-vous vraiment sûr ?');">
                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ image.id) }}">
                <button class="btn">Supprimer</button>
            </form>
        </div>
        {% endfor %}
    </div>
    <div class="col-md-5">
        <h5>Urls</h5>                             
        {% for video in embedUrl %}     
                <div class="col" style="width:100 px; flex: none; margin: 5px">     
                    <iframe width="220" height="140" src="{{ video }}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                      
                  <form method="post" action="{{ path('video_delete', {'id': videoid}) }}"
                        onsubmit="return confirm('Êtes-vous vraiment sûr ?');">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ videoid) }}">
                        <button class="btn">Supprimer</button>
                    </form> 
                </div>
      
        {% endfor %}                 
        
    </div>


    {{ form_start(form) }}
    <div class="col-md-10">{{ form_row(form.name) }}</div>
    <div class="col-md-10">{{ form_row(form.description) }}</div>
    <div class="col-md-10">{{ form_row(form.category) }}</div>
    <div class="col-md-10">{{ form_row(form.imageFiles) }}</div>
    <div class="col-md-10">
        <h5>Videos  à télécharger</h5> 
            <ul class="videos" data-index="{{ form.videos|length > 0 ? form.videos|last.vars.name + 1 : 0 }}" data-prototype="{{ form_widget(form.videos.vars.prototype)|e('html_attr') }}"> 
                    
                    {% for video in form.videos %}
                        <li>{{ form_row(video.url) }}</li>
                    {% endfor %}
                </ul>
        <button type="button" class="add_item_link" data-collection-holder-class="videos">Ajouter video</button>

    </div>

    {{ form_rest(form) }}

    <button class="btn">{{ button_label|default('Enregistrer') }}</button>
    {{ form_end(form) }}


    <a href="{{ path('list') }}">retour à la liste</a>

    {{ include('trick/_delete_form.html.twig') }}
</div>

    {% block javascripts %}
    <script>document.querySelectorAll('.add_item_link').forEach(btn => btn.addEventListener("click", addFormToCollection));
    </script>
    <script>document.querySelectorAll('.add_item_link').forEach(btn => btn.addEventListener("click", addFormToCollection));
    const addFormToCollection = (e) => {
    const collectionHolder = document.querySelector('.' + e.currentTarget.dataset.collectionHolderClass);

    const item = document.createElement('li');

    item.innerHTML = collectionHolder
        .dataset
        .prototype
        .replace(
        /__name__/g,
        collectionHolder.dataset.index
        );

    collectionHolder.appendChild(item);

    collectionHolder.dataset.index++;
    };
    </script>
    {% endblock %}

{% endblock %}